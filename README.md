
# 🔄 Switch Image Update via Console Server

این اسکریپت با استفاده از کتابخانهٔ **`pexpect`** به یک **سرور کنسول** وصل می‌شود و عملیات **به‌روزرسانی سیستم‌عامل سوییچ** را از طریق یک **سرور HTTP** انجام می‌دهد.  
خروجی‌ها به‌صورت زنده با استفاده از **ماژول `logging`** در ترمینال نمایش داده می‌شوند.  

---

## ✨ ویژگی‌ها
- 🔌 **اتصال خودکار** به سرور کنسول با SSH  
- 🖥 **ورود به پورت سریال** و احراز هویت روی سوییچ  
- 🚀 اجرای فرمان `update image` از طریق HTTP  
- 👀 **نمایش زنده خروجی** در ترمینال  
- 🛡 **مدیریت خطاها** با `try/except/finally`  

---

## 📦 پیش‌نیازها
- 🐍 **Python 3.6+**
- 📚 نصب کتابخانه‌ها:
  ```bash
  pip install pexpect

- دسترسی به:

  {     
        سرور کنسول (IP و یوزر/پسورد)
        اطلاعات ورود به سوییچ   
        وب‌سرور حاوی فایل سیستم‌عامل
        IP مدیریت سوییچ و Gateway پیش‌فرض
   }   
   
---

## ⚙ پیکربندی پیش‌فرض در کد

```python
console_ip = "192.168.30.20"
console_pass = "123"
switch_user = "admin"
switch_pass = "zharfpouyan"
webserver_ip = "192.168.0.19"
default_gw = "192.168.30.2"
```

> 📝 **نکته:** این مقادیر را متناسب با شبکهٔ خود تغییر دهید.

---

## ▶ نحوهٔ اجرا

1. 💾 کد را در یک فایل ذخیره کنید، مثلا:

   ```bash
   nano update_switch.py
   ```

2. ▶ اجرا کنید:

   ```bash
   python update_switch.py
   ```

3. ⌨ در حین اجرا، اطلاعات زیر را وارد کنید:

   * **Console server username** 🧑‍💻
   * **Image filename** 📂 (نام فایل روی وب‌سرور)
   * **Management IP with subnet** 🌐 (مثل: `192.168.30.34/24`)

4. 🛠 اسکریپت به‌طور خودکار به سرور کنسول وصل شده و عملیات آپدیت را انجام می‌دهد.

---

## 📜 خروجی

* 📡 تمام پیام‌ها و پاسخ‌های سوییچ به‌صورت زنده در ترمینال نمایش داده می‌شوند.
* ⚠ در صورت بروز مشکل، پیام خطا به‌وضوح ثبت می‌شود.

---

## ⚠ نکات مهم

* قبل از اجرا مطمئن شوید که **سرور کنسول به پورت سریال سوییچ متصل است**.
* فایل **سیستم‌عامل** باید در **وب‌سرور** قرار داشته باشد و از طریق IP تعیین‌شده قابل دسترس باشد.
* تایم‌اوت عملیات آپدیت روی **۱۰ دقیقه** تنظیم شده است ⏳ (`timeout=600`).

---

## 📄 مجوز

این اسکریپت **آزاد** برای استفاده داخلی شما است.
برای استفاده در محیط‌های حساس، ابتدا آن را در محیط تست اجرا کنید 🧪.